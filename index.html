<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>La Roche Posay</title>
		<style>
			.drop-target {
				position: absolute;
				left: 50%;
				top: 50%;
				width: 300px;
				height: 300px;
				transform: translate(-50%, -50%);
				background: rgba(255, 255, 255, 0.08);
				border: 2px dashed #fff;
				border-radius: 50%;
				z-index: 5;
				pointer-events: none;
				animation: drop-target-pulse 1.2s infinite ease-in-out;
			}

			@keyframes drop-target-pulse {
				0% {
					transform: translate(-50%, -50%) scale(1);
					opacity: 0.7;
				}
				50% {
					transform: translate(-50%, -50%) scale(1.15);
					opacity: 1;
				}
				100% {
					transform: translate(-50%, -50%) scale(1);
					opacity: 0.7;
				}
			}

			body {
				/* background: red; */
				margin: 0;
				padding: 0;
				width: 100vw;
				height: 100vh;
				overflow: hidden;
				/* display: flex; */
				/* justify-content: center; */
				/* align-items: center; */
			}

			.slide-container {
				/* background-color: aqua; */
				position: relative;
				width: 100vw;
				height: 56.25vw; /* 16:9 aspect ratio */
				max-width: 100vw;
				max-height: 100vh;
				aspect-ratio: 16 / 9;
				/* background image moved to HTML */
				overflow: hidden;
				box-shadow: 0 8px 40px 8px rgba(0, 0, 0, 0.5), 0 1.5px 8px 0 rgba(0, 0, 0, 0.25);
				display: flex;
				justify-content: center;
				align-items: center;
			}

			.test-container {
				width: 100%;
				height: 100%;
				/* background-color: aquamarine; */
				display: flex;

				/* position: absolute; */
				/* top: 0; */
				/* left: 0; */
				/* width: 1920px; */
				/* height: 1080px; */
				/* display: flex; */
				/* overflow: hidden; */
				justify-content: center;
				align-items: center;
				/* background-color: rgb(155, 48, 197); */
				/* transform: scale(0.1); */
				/* transform-origin: center; */
			}

			.slide-page {
				position: absolute;
				top: 0;
				left: 0;
				/* width: 100%; */
				/* height: 100%; */
				/* display: flex; */
				/* justify-content: center; */
				/* align-items: center; */
				opacity: 0; 
				pointer-events: none;
				transition: opacity 0.7s;
			}
			/*      -webkit-text-size-adjust: 100%;
    font-family: Schibsted Grotesk,sans-serif;
    line-height: 1.42857143;
    user-select: none;
    box-sizing: border-box;
    outline: none;
    margin: 0px;
    padding: 0px;
    border: 0px;
    vertical-align: baseline;
    -webkit-font-smoothing: antialiased;
    -webkit-tap-highlight-color: transparent!important;
    transform-style: preserve-3d;
    width: 1200px;
    height: 675px;
    background-color: rgb(255, 255, 255);
    visibility: visible;
    position: relative;
    overflow: hidden;
    flex: 0 0 auto;
    transform: scale(0.244167);*/

			.slide-page.active {
				opacity: 1;
				pointer-events: auto;
				/* z-index: 1; */
			}

			.slide-content {
				position: absolute;
				width: 1920px;
				height: 1080px;
				overflow: hidden;
				box-shadow: 0 8px 40px 8px rgba(0, 0, 0, 0.5), 0 1.5px 8px 0 rgba(0, 0, 0, 0.25);
				/* transform-origin: 0 0; */
			}

			.internal-slide-content {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				/* overflow: hidden; */
				transform: scale(0.1);
				transform-origin: center;
			}

			/* Page 1 elements */

			.start-btn {
				position: absolute;
				top: 55%;
				left: 50%;
				transform: translate(-50%, -50%);
				border: none;
				background: none;
				padding: 0;
				cursor: pointer;
				outline: none;
				z-index: 2;
				animation: pulse 1.8s infinite;
			}
			.start-btn img {
				display: block;
				/* width: 20%; */
				/* height: auto; */
				pointer-events: none;
				user-select: none;
			}

			@keyframes pulse {
				0% {
					transform: translate(-50%, -50%) scale(1);
				}
				50% {
					transform: translate(-50%, -50%) scale(1.08);
				}
				100% {
					transform: translate(-50%, -50%) scale(1);
				}
			}

			/* Page 2 elements */

			.bottle-img {
				position: absolute;
				bottom: 70px;
				right: 70px;
				width: 170px;
				height: auto;
				pointer-events: none;
			}

			.dropper-img {
				position: absolute;
				bottom: 300px;
				right: 85px;
				width: 140px;
				height: auto;
				cursor: grab;
				touch-action: none;
				z-index: 20;
				animation: dropper-pulse 2s infinite ease-in-out;
			}

			@keyframes dropper-pulse {
				0% {
					transform: translateY(0);
				}
				50% {
					transform: translateY(-40px);
				}
				100% {
					transform: translateY(0);
				}
			}

			/* Page 4 elements */
		</style>
	</head>
	<body>
		<div class="test-container">
			<div class="slide-content">
				<!-- <img src="start_bkg.jpeg" style="width: 100%; height: 100%" alt="Background" draggable="false" /> -->
				<!-- <div class="internal-slide-content"> -->
				<!-- <div style="width: 1920px; height: 10px;"></div> -->
				<!-- Page 1 -->
				<div class="slide-page active" id="page1">
					<img src="start_bkg.jpeg" alt="Background" draggable="false" />
					<button class="start-btn" onclick="showPage2()">
						<img src="start_button.png" alt="Start" draggable="false" />
					</button>
				</div>

				<!-- Page 2 -->
				<div class="slide-page" id="page2">
					<img src="ready_bkg.jpg" alt="Background" draggable="false" />
					<div class="drop-target" id="dropTarget"></div>
					<img src="bottle.png" alt="Bottle" class="bottle-img" draggable="false" />
					<img src="dropper.png" alt="Dropper" class="dropper-img" draggable="false" />
				</div>

				<!-- Page 3 -->
				<!-- <div class="slide-page" id="page3">
							<video id="introVideo" width="100%" height="100%" autoplay>
								<source src="intro_video.mp4" type="video/mp4" />
								Your browser does not support the video tag.
							</video>
						</div> -->

				<!-- Page 4 -->
				<!-- <div class="slide-page" id="page4">
							<img src="game_bkg.png" alt="Background" draggable="false" />
						</div> -->
			</div>
			<!-- </div> -->
		</div>
	</body>
</html>
<script>
	// Make dropper draggable on page 2
	function makeDropperDraggable() {
		const dropper = document.querySelector('#page2 .dropper-img');
		const slideContent = document.querySelector('.slide-content');
		const dropTarget = document.getElementById('dropTarget');
		const page2 = document.getElementById('page2');
		const page3 = document.getElementById('page3');
		// if (!dropper || !slideContent || !dropTarget || !page2 || !page3) return;
		let isDragging = false;
		let startX,
			startY,
			origX,
			origY,
			scale = 1;
		let triggered = false;
		let overTarget = false;

		// Helper to get current position
		function getCurrentPos() {
			const style = window.getComputedStyle(dropper);
			return {
				left: parseInt(style.left || 0, 10) || 0,
				top: parseInt(style.top || 0, 10) || 0,
			};
		}

		function getCurrentScale() {
			const st = window.getComputedStyle(slideContent);
			const tr = st.transform || st.webkitTransform || st.mozTransform;
			if (tr && tr !== 'none') {
				const match = tr.match(/matrix\(([^)]+)\)/);
				if (match) {
					const values = match[1].split(',');
					return parseFloat(values[0]);
				}
			}
			return 1;
		}

		function checkDropTarget() {
			// Get bounding rects relative to .slide-content
			const dropperRect = dropper.getBoundingClientRect();
			const targetRect = dropTarget.getBoundingClientRect();
			// Check if dropper center is inside target
			const dropperCenter = {
				x: dropperRect.left + dropperRect.width / 2,
				y: dropperRect.top + dropperRect.height / 2,
			};
			overTarget = dropperCenter.x > targetRect.left && dropperCenter.x < targetRect.right && dropperCenter.y > targetRect.top && dropperCenter.y < targetRect.bottom;
		}

		// Mouse events
		dropper.addEventListener('mousedown', function (e) {
			isDragging = true;
			dropper.style.cursor = 'grabbing';
			const pos = getCurrentPos();
			startX = e.clientX;
			startY = e.clientY;
			origX = pos.left;
			origY = pos.top;
			scale = getCurrentScale();
			document.addEventListener('mousemove', onMouseMove);
			document.addEventListener('mouseup', onMouseUp);
		});
		function onMouseMove(e) {
			if (!isDragging) return;
			const dx = (e.clientX - startX) / scale;
			const dy = (e.clientY - startY) / scale;
			dropper.style.left = origX + dx + 'px';
			dropper.style.top = origY + dy + 'px';
			dropper.style.bottom = 'auto';
			dropper.style.right = 'auto';
			checkDropTarget();
		}
		function onMouseUp() {
			isDragging = false;
			dropper.style.cursor = 'grab';
			document.removeEventListener('mousemove', onMouseMove);
			document.removeEventListener('mouseup', onMouseUp);
			if (overTarget && !triggered) {
				triggered = true;
				page2.classList.remove('active');
				page3.classList.add('active');
				const vid = document.getElementById('introVideo');
				if (vid) vid.play();
			}
		}

		// Touch events
		dropper.addEventListener('touchstart', function (e) {
			if (e.touches.length !== 1) return;
			isDragging = true;
			dropper.style.cursor = 'grabbing';
			const pos = getCurrentPos();
			startX = e.touches[0].clientX;
			startY = e.touches[0].clientY;
			origX = pos.left;
			origY = pos.top;
			scale = getCurrentScale();
			document.addEventListener('touchmove', onTouchMove, { passive: false });
			document.addEventListener('touchend', onTouchEnd);
		});
		function onTouchMove(e) {
			if (!isDragging || e.touches.length !== 1) return;
			e.preventDefault();
			const dx = (e.touches[0].clientX - startX) / scale;
			const dy = (e.touches[0].clientY - startY) / scale;
			dropper.style.left = origX + dx + 'px';
			dropper.style.top = origY + dy + 'px';
			dropper.style.bottom = 'auto';
			dropper.style.right = 'auto';
			checkDropTarget();
		}
		function onTouchEnd() {
			isDragging = false;
			dropper.style.cursor = 'grab';
			document.removeEventListener('touchmove', onTouchMove);
			document.removeEventListener('touchend', onTouchEnd);
			if (overTarget && !triggered) {
				triggered = true;
				page2.classList.remove('active');
				page3.classList.add('active');
				const vid = document.getElementById('introVideo');
				if (vid) vid.play();
			}
		}
	}

	function showPage2() {
		const page1 = document.getElementById('page1');
		const page2 = document.getElementById('page2');
		page1.classList.remove('active');
		page2.classList.add('active');
	}

	document.addEventListener('DOMContentLoaded', makeDropperDraggable);
	// Fade transition between pages
	document.addEventListener('DOMContentLoaded', function () {
		const btn = document.querySelector('.start-btn');
		const page1 = document.getElementById('page1');
		const page2 = document.getElementById('page2');
		const page3 = document.getElementById('page3');
		// if (btn && page1 && page2) {
		// 	btn.addEventListener('click', function () {
		// 		page1.classList.remove('active');
		// 		page2.classList.add('active');
		// 		// Move to page 4 when video finishes
		// 		const page4 = document.getElementById('page4');
		// 		const video = document.getElementById('introVideo');
		// 		if (video && page3 && page4) {
		// 			setTimeout(() => {
		// 				page3.classList.remove('active');
		// 				page4.classList.add('active');
		// 			}, 7000);
		// 		}
		// 	});
		// }
	});
	// Scale .slide-content to fit .slide-container (16:9)
	function scaleSlideContent() {
		// const container = document.querySelector('.slide-container');
		const content = document.querySelector('.slide-content');
		
		const container = document.querySelector('.test-container');
		const containerWidth = container.clientWidth;
		const containerHeight = container.clientHeight;

		// Get size of viewport
		// const viewportWidth = window.innerWidth;
		// const viewportHeight = window.innerHeight;

		const scaleX = containerWidth / 1920;
		const scaleY = containerHeight / 1080;
		const scale = Math.min(scaleX, scaleY);
		content.style.transform = `scale(${scale})`;
		// content.style.width = 1920 * scale + 'px';
		// content.style.height = 1080 * scale + 'px';
	}
	window.addEventListener('resize', scaleSlideContent);
	window.addEventListener('DOMContentLoaded', scaleSlideContent);
</script>
